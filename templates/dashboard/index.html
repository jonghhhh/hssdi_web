{% extends "base.html" %}

{% block title %}ëŒ€ì‹œë³´ë“œ - ì¸ë¬¸Â·ì‚¬íšŒê³¼í•™ ë°ì´í„° ì—°êµ¬ì†Œ{% endblock %}

{% block content %}
<div class="container">
    <section class="hero">
        <h1>ì—°êµ¬ì†Œ ëŒ€ì‹œë³´ë“œ</h1>
        <p>ì‹¤ì‹œê°„ ì—°êµ¬ í˜„í™© ë° ë°ì´í„° í†µê³„</p>
    </section>

    <!-- í†µê³„ ì¹´ë“œ -->
    <section class="stats">
        <div class="stat-card">
            <div class="stat-number">{{ stats.posts }}</div>
            <div class="stat-label">ê²Œì‹œë¬¼</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ stats.research }}</div>
            <div class="stat-label">ì—°êµ¬ í”„ë¡œì íŠ¸</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ stats.news }}</div>
            <div class="stat-label">ë‰´ìŠ¤</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ stats.users }}</div>
            <div class="stat-label">ì‚¬ìš©ì</div>
        </div>
    </section>

    <div class="grid grid-2">
        <!-- ìµœê·¼ ê²Œì‹œë¬¼ -->
        <div class="card">
            <h2 class="card-title">ìµœê·¼ ê²Œì‹œë¬¼</h2>
            {% if recent_posts %}
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ì œëª©</th>
                                <th>ì‘ì„±ì¼</th>
                                <th>ì¡°íšŒìˆ˜</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for post in recent_posts %}
                            <tr>
                                <td><a href="/board/{{ post.id }}" style="color: var(--primary-color); text-decoration: none;">{{ post.title[:50] }}{% if post.title|length > 50 %}...{% endif %}</a></td>
                                <td>{{ post.created_at.strftime('%Y-%m-%d') }}</td>
                                <td>{{ post.views }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <p>ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}
            <div style="text-align: center; margin-top: 1rem;">
                <a href="/board" class="btn btn-outline">ì „ì²´ ê²Œì‹œë¬¼ ë³´ê¸°</a>
            </div>
        </div>

        <!-- ìµœê·¼ ì—°êµ¬ -->
        <div class="card">
            <h2 class="card-title">ì§„í–‰ ì¤‘ì¸ ì—°êµ¬</h2>
            {% if recent_research %}
                {% for research in recent_research %}
                <div style="border-left: 4px solid var(--primary-color); padding-left: 1rem; margin-bottom: 1rem;">
                    <h4 style="color: var(--primary-color);">{{ research.title }}</h4>
                    <p>{{ research.description[:100] if research.description else 'ì„¤ëª… ì—†ìŒ' }}{% if research.description and research.description|length > 100 %}...{% endif %}</p>
                    <small style="color: var(--gray);">ìƒíƒœ: {{ research.status }} | ìœ í˜•: {{ research.research_type or 'ë¯¸ë¶„ë¥˜' }}</small>
                </div>
                {% endfor %}
            {% else %}
                <p>ì§„í–‰ ì¤‘ì¸ ì—°êµ¬ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}
            <div style="text-align: center; margin-top: 1rem;">
                <a href="/dashboard/research" class="btn btn-outline">ì—°êµ¬ í˜„í™© ë³´ê¸°</a>
            </div>
        </div>
    </div>

    <!-- ìµœì‹  ë‰´ìŠ¤ -->
    <div class="card">
        <h2 class="card-title">ì£¼ìš” ë‰´ìŠ¤</h2>
        {% if latest_news %}
            <div class="grid grid-3">
                {% for news in latest_news %}
                <div class="card" style="background: linear-gradient(135deg, var(--secondary-color), var(--dark-red)); color: white;">
                    <h4>{{ news.title }}</h4>
                    <p>{{ news.content[:150] }}{% if news.content|length > 150 %}...{% endif %}</p>
                    <small>{{ news.published_at.strftime('%Y-%m-%d') if news.published_at else news.created_at.strftime('%Y-%m-%d') }}</small>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p>ë“±ë¡ëœ ë‰´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endif %}
    </div>

    <!-- ë¹ ë¥¸ ë§í¬ -->
    <div class="grid grid-4" style="margin-top: 2rem;">
        <a href="/dashboard/analytics" class="btn btn-primary" style="text-align: center; padding: 2rem;">
            ğŸ“Š<br>ë¶„ì„ ë¦¬í¬íŠ¸
        </a>
        <a href="/dashboard/research" class="btn btn-secondary" style="text-align: center; padding: 2rem;">
            ğŸ”¬<br>ì—°êµ¬ í˜„í™©
        </a>
        <a href="/board/create" class="btn btn-outline" style="text-align: center; padding: 2rem;">
            âœï¸<br>ê²Œì‹œë¬¼ ì‘ì„±
        </a>
        <a href="/crudadmin" class="btn btn-outline" style="text-align: center; padding: 2rem;">
            âš™ï¸<br>ê´€ë¦¬ì íŒ¨ë„
        </a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ (5ë¶„ë§ˆë‹¤)
    setInterval(function() {
        location.reload();
    }, 300000);

    // í†µê³„ ì¹´ë“œ ì• ë‹ˆë©”ì´ì…˜
    document.addEventListener('DOMContentLoaded', function() {
        const statNumbers = document.querySelectorAll('.stat-number');
        statNumbers.forEach(stat => {
            const finalValue = parseInt(stat.textContent);
            let currentValue = 0;
            const increment = finalValue / 50;

            const timer = setInterval(() => {
                currentValue += increment;
                if (currentValue >= finalValue) {
                    currentValue = finalValue;
                    clearInterval(timer);
                }
                stat.textContent = Math.floor(currentValue);
            }, 20);
        });
    });
</script>
{% endblock %}